{
  "next_issue": {
    "key": "P09",
    "title": "Adicionar rota protegida /app/upload com UI de envio (metadados) e estado inicial",
    "rationale": "Com P08 fechado (fluxo lista -> detalhe -> voltar preservando querystring), o próximo passo lógico para evoluir o produto é permitir a entrada de novos itens no acervo. Como a arquitetura já fixa Supabase apenas como IdP e SSR protegido em /app, a inclusão incremental via uma rota /app/upload permite entregar valor sem tocar em auth/session: primeiro a UI/UX e contrato de payload (metadados), depois a persistência via PostgREST e, por fim, a integração de upload propriamente dita quando o backend/armazenamento estiver pronto."
  },
  "plan": "Entregar P09 em 3 PRs pequenos: (1) criar a rota /app/upload com UI de formulário e estados (idle/submitting/success/error) sem persistência; (2) conectar o action SSR para validar e enviar metadados ao PostgREST criando um registro 'draft' (sem upload binário); (3) integrar navegação (link no layout de /app) e refinar UX (mensagens, disabled states, retorno para lista preservando querystring) sem alterar auth/session.",
  "prs": [
    {
      "pr": "PR1",
      "branch": "feature/23-app-upload-ui",
      "scope": "Criar rota protegida /app/upload com formulário SSR (UI only) para metadados de mídia (título, descrição, tags) e estados básicos. Sem integração PostgREST e sem upload binário.",
      "files": [
        "app/routes/app.upload.tsx"
      ],
      "responsibilities": [
        "Adicionar página /app/upload renderizada via Remix SSR dentro de /app (herdando proteção existente).",
        "Implementar formulário com campos: título, descrição, tags (CSV) e tipo (foto/vídeo) apenas para UI.",
        "Implementar validação leve no client (mínimos: título obrigatório; tags normalizadas).",
        "Preparar estrutura compatível com um futuro action SSR (sem implementar persistência agora).",
        "Manter Tailwind e padrões visuais do app."
      ],
      "commit_sequence": [
        "feat(p09): scaffold da rota /app/upload (Refs #23)",
        "feat(p09): UI do formulário e estados iniciais (Closes #23)"
      ]
    },
    {
      "pr": "PR2",
      "branch": "feature/23-app-upload-action-postgrest",
      "scope": "Adicionar action SSR em /app/upload para validar payload e criar registro de mídia (draft) via PostgREST. Sem upload de arquivo.",
      "files": [
        "app/routes/app.upload.tsx",
        "app/services/postgrest.server.ts",
        "app/services/media.server.ts",
        "app/utils/validation.server.ts"
      ],
      "responsibilities": [
        "Implementar validação server-side (título, tags, tipo).",
        "Chamar PostgREST para criar registro de mídia em estado 'draft' e retornar id criado.",
        "Tratar erros de rede/validação com mensagens amigáveis.",
        "Garantir que qualquer falha não afete sessão/auth e respeite SSR."
      ],
      "commit_sequence": [
        "feat(p09): action SSR criando draft via PostgREST (Refs #23)",
        "feat(p09): tratamento de erro e retorno com id criado (Closes #23)"
      ]
    },
    {
      "pr": "PR3",
      "branch": "feature/23-app-nav-upload-link-ux",
      "scope": "Adicionar link de navegação para /app/upload no layout/menú do /app e refinar UX (voltar para lista preservando querystring, mensagens e estados).",
      "files": [
        "app/routes/app.tsx",
        "app/components/app-nav.tsx",
        "app/routes/app._index.tsx"
      ],
      "responsibilities": [
        "Incluir link 'Enviar' / 'Upload' no menu do /app.",
        "Após criação do draft (PR2), oferecer CTA para voltar à lista mantendo querystring atual.",
        "Ajustar microcopy, disabled states e acessibilidade básica (labels/aria).",
        "Não alterar auth/session nem rotas já existentes."
      ],
      "commit_sequence": [
        "feat(p09): link de navegação para /app/upload (Refs #23)",
        "feat(p09): refinamentos de UX e retorno preservando querystring (Closes #23)"
      ]
    }
  ],
  "files_to_change": [
    "app/routes/app.upload.tsx",
    "app/services/postgrest.server.ts",
    "app/services/media.server.ts",
    "app/utils/validation.server.ts",
    "app/routes/app.tsx",
    "app/components/app-nav.tsx",
    "app/routes/app.*index.tsx"
  ],
  "acceptance_criteria": [
    "Existe uma rota SSR em /app/upload acessível apenas no contexto protegido de /app (sem mudanças em auth/session).",
    "PR1: Página renderiza formulário com campos de metadados e estados básicos sem persistência; build/testes existentes continuam passando.",
    "PR2: Submissão valida server-side e cria registro 'draft' via PostgREST retornando um id, com tratamento de erro apropriado.",
    "PR3: Navegação do /app inclui link para /app/upload e o fluxo oferece retorno para a lista preservando querystring.",
    "Nenhum token é gravado em localStorage/sessionStorage; nenhuma alteração em createCookieSessionStorage, cookies ou destroySession/redirect.",
    "Não há inclusão de OAuth social."
  ],
  "risks": [
    "Estrutura/nomes de módulos internos (serviços PostgREST, componentes de navegação) podem divergir do previsto, exigindo ajuste de paths e imports ao implementar PR2/PR3.",
    "Contrato de criação de mídia (campos esperados pelo PostgREST) pode não estar finalizado; mitigar mantendo PR1 UI-only e PR2 com validação e payload mínimo.",
    "UX pode conflitar com padrões existentes de layout (ex.: header/side menu); mitigar limitando PR1 a uma rota isolada e ajustes de navegação apenas no PR3."
  ],
  "git_commands": {
    "branch": [
      "cd /e/GitHub/mediashare",
      "git checkout main",
      "git pull origin main",
      "gh issue create --title "P09: Adicionar rota protegida /app/upload com UI de envio (metadados) e estado inicial" --body "Escopo: criar /app/upload (UI-only) para metadados (título, descrição, tags, tipo) e estados básicos. Sem PostgREST e sem upload binário. Não alterar auth/session."",
      "export ISSUE=23",
      "git checkout -b feature/$ISSUE-app-upload-ui"
    ],
    "commit": [
      "git status",
      "git add app/routes/app.upload.tsx",
      "git commit -m "feat(p09): scaffold da rota /app/upload (Refs #23)"",
      "git commit -m "feat(p09): UI do formulário e estados iniciais (Closes #23)""
    ],
    "push": [
      "git push -u origin feature/23-app-upload-ui"
    ],
    "pr_create": [
      "gh pr create --base main --head feature/23-app-upload-ui --title "P09: /app/upload UI inicial" --body "Implementa rota SSR protegida /app/upload com formulário de metadados (UI-only). Refs/Closes #23."",
      "gh pr merge --merge --delete-branch"
    ]
  },
  "initial_code_pr1": {
    "path": "app/routes/app.upload.tsx",
    "content": "import { useMemo, useState } from "react";\nimport type { MetaFunction } from "@remix-run/node";\n\nexport const meta: MetaFunction = () => {\n  return [\n    { title: "Upload | Phosio" },\n    { name: "description", content: "Enviar nova mídia para o seu acervo no Phosio." }\n  ];\n};\n\ntype MediaType = "photo" | "video";\n\ntype FormState = {\n  title: string;\n  description: string;\n  tagsCsv: string;\n  mediaType: MediaType;\n};\n\nfunction normalizeTags(tagsCsv: string): string[] {\n  const raw = tagsCsv\n    .split(",")\n    .map((t) => t.trim())\n    .filter(Boolean);\n\n  const normalized = raw\n    .map((t) => t.toLowerCase())\n    .map((t) => t.replace(/\s+/g, "-"))\n    .map((t) => t.replace(/[^a-z0-9\-*.]/g, ""))\n    .filter(Boolean);\n\n  return Array.from(new Set(normalized));\n}\n\nfunction isValidTitle(value: string): boolean {\n  return value.trim().length >= 3;\n}\n\nexport default function AppUploadRoute() {\n  const [form, setForm] = useState<FormState>({\n    title: "",\n    description: "",\n    tagsCsv: "",\n    mediaType: "photo"\n  });\n\n  const tagsPreview = useMemo(() => normalizeTags(form.tagsCsv), [form.tagsCsv]);\n\n  const titleOk = isValidTitle(form.title);\n  const canSubmit = titleOk;\n\n  return (\n    <div className="mx-auto w-full max-w-3xl px-4 py-8">\n      <header className="mb-6">\n        <h1 className="text-2xl font-semibold tracking-tight">Enviar mídia</h1>\n        <p className="mt-2 text-sm text-slate-600">\n          Cadastre os metadados agora. A integração de persistência/upload será adicionada em etapas.\n        </p>\n      </header>\n\n      <div className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">\n        <form method="post" className="space-y-6">\n          <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">\n            <div className="sm:col-span-2">\n              <label htmlFor="title" className="block text-sm font-medium text-slate-900">\n                Título <span className="text-rose-600">*</span>\n              </label>\n              <input\n                id="title"\n                name="title"\n                type="text"\n                value={form.title}\n                onChange={(e) => setForm((p) => ({ ...p, title: e.target.value }))}\n                placeholder="Ex.: Viagem 2026 - Praia"\n                className="mt-2 w-full rounded-xl border border-slate-300 px-3 py-2 text-sm outline-none focus:border-slate-400"\n                aria-invalid={!titleOk}\n                aria-describedby="title-help"\n              />\n              <p id="title-help" className="mt-2 text-xs text-slate-600">\n                Mínimo de 3 caracteres.\n              </p>\n            </div>\n\n            <div>\n              <label htmlFor="mediaType" className="block text-sm font-medium text-slate-900">\n                Tipo\n              </label>\n              <select\n                id="mediaType"\n                name="mediaType"\n                value={form.mediaType}\n                onChange={(e) => setForm((p) => ({ ...p, mediaType: e.target.value as MediaType }))}\n                className="mt-2 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm outline-none focus:border-slate-400"\n              >\n                <option value="photo">Foto</option>\n                <option value="video">Vídeo</option>\n              </select>\n            </div>\n\n            <div>\n              <label htmlFor="tags" className="block text-sm font-medium text-slate-900">\n                Tags (separadas por vírgula)\n              </label>\n              <input\n                id="tags"\n                name="tags"\n                type="text"\n                value={form.tagsCsv}\n                onChange={(e) => setForm((p) => ({ ...p, tagsCsv: e.target.value }))}\n                placeholder="Ex.: família, viagem, praia"\n                className="mt-2 w-full rounded-xl border border-slate-300 px-3 py-2 text-sm outline-none focus:border-slate-400"\n              />\n              <p className="mt-2 text-xs text-slate-600">\n                Prévia normalizada: {tagsPreview.length ? tagsPreview.join(",
    ") : "(vazio)"}\n              </p>\n            </div>\n          </div>\n\n          <div>\n            <label htmlFor="description" className="block text-sm font-medium text-slate-900">\n              Descrição\n            </label>\n            <textarea\n              id="description"\n              name="description"\n              value={form.description}\n              onChange={(e) => setForm((p) => ({ ...p, description: e.target.value }))}\n              placeholder="Notas opcionais sobre esta mídia..."\n              rows={5}\n              className="mt-2 w-full resize-y rounded-xl border border-slate-300 px-3 py-2 text-sm outline-none focus:border-slate-400"\n            />\n          </div>\n\n          <div className="rounded-xl border border-slate-200 bg-slate-50 p-4">\n            <p className="text-sm font-medium text-slate-900">Arquivo</p>\n            <p className="mt-1 text-sm text-slate-600">\n              Upload binário ainda não habilitado neste PR. Este formulário prepara o fluxo de metadados.\n            </p>\n          </div>\n\n          <div className="flex items-center justify-end gap-3">\n            <button\n              type="submit"\n              disabled={!canSubmit}\n              className="rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white disabled:cursor-not-allowed disabled:opacity-60"\n            >\n              Continuar\n            </button>\n          </div>\n        </form>\n      </div>\n\n      <footer className="mt-6 text-xs text-slate-500">\n        Este PR não implementa persistência nem upload. Próximos PRs conectarão o action SSR ao PostgREST.\n      </footer>\n    </div>\n  );\n}\n"
  }
}