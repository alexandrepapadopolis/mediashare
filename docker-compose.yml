name: mediashare

services:
  # ----------------------------------------------------------
  # APLICAÇÃO WEB (FRONTEND)
  # ----------------------------------------------------------
  app-dev:
    container_name: mediashare-app-dev
    profiles: ["dev"]
    image: node:20-bookworm-slim
    working_dir: /app
    ports:
      - "5173:5173"

    environment:
      VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
      VITE_SUPABASE_PUBLISHABLE_KEY: ${VITE_SUPABASE_PUBLISHABLE_KEY}
      CHOKIDAR_USEPOLLING: "true"
      CHOKIDAR_INTERVAL: "200"
      NPM_CONFIG_UPDATE_NOTIFIER: "false"

    volumes:
      - .:/app
      - /app/node_modules
    
    command: >
      sh -lc "
        echo 'Iniciando MediaShare Web...';
        npm ci --foreground-scripts || npm install --foreground-scripts;
        npm run dev -- --host 0.0.0.0 --port 5173
      "

  # ----------------------------------------------------------
  # PRODUÇÃO
  # ----------------------------------------------------------
  app-prod:
    container_name: mediashare-app-prod
    profiles: ["prod"]
    build:
      context: .
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_PUBLISHABLE_KEY: ${VITE_SUPABASE_PUBLISHABLE_KEY}
    ports:
      - "8080:80"
    restart: unless-stopped